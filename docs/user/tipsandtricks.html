


<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Tips &amp; tricks &#8212; conda-forge 2022.08.03 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/cloud.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noticia+Text:400,i,b,bi|Open+Sans:400,i,b,bi|Roboto+Mono:400,i,b,bi&amp;display=swap" type="text/css" />
    
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>

    
    
     
        <script src="../_static/jquery.cookie.js"></script>
    

    
     
        <script src="../_static/cloud.base.js"></script>
    

    
     
        <script src="../_static/cloud.js"></script>
    

    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Using conda-smithy to manage your CI" href="ci-skeleton.html" />
    <link rel="prev" title="Announcements" href="announcements.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1">
  </head><body>
    <div class="relbar-top">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ci-skeleton.html" title="Using conda-smithy to manage your CI"
             accesskey="N">next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="announcements.html" title="Announcements"
             accesskey="P">previous</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">conda-forge 2022.08.03 documentation</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="00_intro.html" accesskey="U">User Documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Tips &amp; tricks</a></li> 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="tips-tricks">
<h1>Tips &amp; tricks<a class="headerlink" href="#tips-tricks" title="Permalink to this heading">¶</a></h1>
<section id="using-multiple-channels">
<span id="multiple-channels"></span><h2>Using multiple channels<a class="headerlink" href="#using-multiple-channels" title="Permalink to this heading">¶</a></h2>
<p>It is quite common to install a package from conda-forge and,
when trying to use it,
see an error like (OS X example):</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>ImportError: dlopen<span class="o">(</span>.../site-packages/rpy2/rinterface/_rinterface.so, <span class="m">2</span><span class="o">)</span>: Library not loaded: @rpath/libicuuc.54.dylib
  Referenced from: .../site-packages/rpy2/rinterface/_rinterface.so
  Reason: image not found
</pre></div>
</div>
<p>That happens because either the correct version of <code class="docutils literal notranslate"><span class="pre">icu</span></code>,
or any other package in the error,
is not present or the package is missing altogether.</p>
<p>You can confirm this by issuing the command <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">list</span></code> and searching for the package in question.</p>
<section id="why-does-that-happen">
<h3>Why does that happen?<a class="headerlink" href="#why-does-that-happen" title="Permalink to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">conda-forge</span></code> and <code class="docutils literal notranslate"><span class="pre">defaults</span></code> are not 100% compatible.
In the example above it is known that <code class="docutils literal notranslate"><span class="pre">defaults</span></code> uses <code class="docutils literal notranslate"><span class="pre">icu</span> <span class="pre">54.*</span></code> while <code class="docutils literal notranslate"><span class="pre">conda-forge</span></code> relies on <code class="docutils literal notranslate"><span class="pre">icu</span> <span class="pre">56.*</span></code>,
that mismatch can lead to errors when the install environment is mixing packages from multiple channels.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All of conda-forge software pinning can be found at: <a class="reference external" href="https://github.com/conda-forge/conda-forge-pinning-feedstock/blob/master/recipe/conda_build_config.yaml">https://github.com/conda-forge/conda-forge-pinning-feedstock/blob/master/recipe/conda_build_config.yaml</a></p>
</div>
</section>
<section id="how-to-fix-it">
<h3>How to fix it?<a class="headerlink" href="#how-to-fix-it" title="Permalink to this heading">¶</a></h3>
<p>Newer <code class="docutils literal notranslate"><span class="pre">conda</span></code> versions (&gt;=4.6) introduced a strict channel priority feature.
Type <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">config</span> <span class="pre">--describe</span> <span class="pre">channel_priority</span></code> for more information.</p>
<p>The solution is to add the <code class="docutils literal notranslate"><span class="pre">conda-forge</span></code> channel on top of <code class="docutils literal notranslate"><span class="pre">defaults</span></code> in your <code class="docutils literal notranslate"><span class="pre">.condarc</span></code> file when using <code class="docutils literal notranslate"><span class="pre">conda-forge</span></code> packages
and activate the strict channel priority with:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ conda config --set channel_priority strict
</pre></div>
</div>
<p>This will ensure that all the dependencies come from the <code class="docutils literal notranslate"><span class="pre">conda-forge</span></code> channel unless they exist only on <code class="docutils literal notranslate"><span class="pre">defaults</span></code>.</p>
<p>Here is how a <code class="docutils literal notranslate"><span class="pre">.condarc</span></code> file would look like:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ cat .condarc
channel_priority: strict
channels:
  - conda-forge
  - defaults
</pre></div>
</div>
<p>In addition to the channel priority, we recommend always installing your packages inside a new environment instead of the <code class="docutils literal notranslate"><span class="pre">base</span></code> environment from anaconda/miniconda.
Using envs make it easier to debug problems with packages and ensure the stability of your root env.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In the past <code class="docutils literal notranslate"><span class="pre">conda-forge</span></code> used to vendorize some of <code class="docutils literal notranslate"><span class="pre">defaults</span></code> dependencies that were not built in our infrastructure,
like compilers run-times, to avoid the mixing channel problem.
However, with the <code class="docutils literal notranslate"><span class="pre">strict</span></code> option, we no longer have to vendorize those (this led to its own set of problems),
instead, we removed everything that is not built in <code class="docutils literal notranslate"><span class="pre">conda-forge</span></code> and let <code class="docutils literal notranslate"><span class="pre">strict</span></code> pull those from <code class="docutils literal notranslate"><span class="pre">defaults</span></code>.</p>
<p>TL;DR if you are experiencing missing compilers run-times like <code class="docutils literal notranslate"><span class="pre">libgcc-ng</span></code>,
that is probably because you removed <code class="docutils literal notranslate"><span class="pre">defaults</span></code>,
just re-add it and activate <code class="docutils literal notranslate"><span class="pre">strict</span></code> for a smooth and stable experience when installing packages.</p>
</div>
</section>
</section>
<section id="using-external-message-passing-interface-mpi-libraries">
<span id="id1"></span><h2>Using External Message Passing Interface (MPI) Libraries<a class="headerlink" href="#using-external-message-passing-interface-mpi-libraries" title="Permalink to this heading">¶</a></h2>
<p>On some high-performance computing (HPC) systems, users are expected to use the
MPI binaries that are available on the system as opposed to those built by <code class="docutils literal notranslate"><span class="pre">conda-forge</span></code>.
These binaries are typically specialized for the system and interface properly with job
schedulers, etc. However, this practice creates issues for <code class="docutils literal notranslate"><span class="pre">conda-forge</span></code> users. When you install
a package from <code class="docutils literal notranslate"><span class="pre">conda-forge</span></code> that relies on MPI, <code class="docutils literal notranslate"><span class="pre">conda</span></code> will install the MPI binaries
built by <code class="docutils literal notranslate"><span class="pre">conda-forge</span></code> and the package will link to those binaries. This setup often either
does not work at all or functions in unexpected ways on HPC systems.</p>
<p>To solve these issues, <code class="docutils literal notranslate"><span class="pre">conda-forge</span></code> has created special dummy builds of the <code class="docutils literal notranslate"><span class="pre">mpich</span></code> and <code class="docutils literal notranslate"><span class="pre">openmpi</span></code>
libraries that are simply shell packages with no contents. These packages allow the <code class="docutils literal notranslate"><span class="pre">conda</span></code> solver to produce
correct environments while avoiding installing MPI binaries from <code class="docutils literal notranslate"><span class="pre">conda-forge</span></code>. You can install the
dummy package with the following command</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ conda install <span class="s2">&quot;mpich=x.y.z=external_*&quot;</span>
$ conda install <span class="s2">&quot;openmpi=x.y.z=external_*&quot;</span>
</pre></div>
</div>
<p>As long as you have the local copies of the <code class="docutils literal notranslate"><span class="pre">mpich</span></code>/<code class="docutils literal notranslate"><span class="pre">openmpi</span></code> library in your linking paths and
the local version matches the <code class="docutils literal notranslate"><span class="pre">conda</span></code> version within the proper ABI range, then this procedure should
work. At runtime, the <code class="docutils literal notranslate"><span class="pre">conda-forge</span></code> package that depends on MPI should find the
local copy of <code class="docutils literal notranslate"><span class="pre">mpich</span></code>/<code class="docutils literal notranslate"><span class="pre">openmpi</span></code> and link to it.</p>
</section>
<section id="installing-apple-intel-packages-on-apple-silicon">
<span id="apple-silicon-rosetta"></span><h2>Installing Apple Intel packages on Apple Silicon<a class="headerlink" href="#installing-apple-intel-packages-on-apple-silicon" title="Permalink to this heading">¶</a></h2>
<p>Using <a class="reference external" href="https://support.apple.com/en-us/HT211861">Rosetta 2</a>, you can install packages originally compiled for Mac computers with Intel processors on Mac computers with Apple silicon processors.</p>
<p>This can be enabled per environment using the following commands:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nv">CONDA_SUBDIR</span><span class="o">=</span>osx-64 conda create -n your_environment_name python   <span class="c1"># Create a new environment called your_environment_name with intel packages.</span>
conda activate your_environment_name
python -c <span class="s2">&quot;import platform;print(platform.machine())&quot;</span>  <span class="c1"># Confirm that the correct values are being used.</span>
conda config --env --set subdir osx-64  <span class="c1"># Make sure that conda commands in this environment use intel packages.</span>
</pre></div>
</div>
<p>To verify that the correct platform is being used, run the following commands after the environment has been activated:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>python -c <span class="s2">&quot;import platform;print(platform.machine())&quot;</span>  <span class="c1"># Should print &quot;x86_64&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;CONDA_SUBDIR: </span><span class="nv">$CONDA_SUBDIR</span><span class="s2">&quot;</span>  <span class="c1"># Should print &quot;CONDA_SUBDIR: osx-64&quot;</span>
</pre></div>
</div>
</section>
<section id="installing-cuda-enabled-packages-like-tensorflow-and-pytorch">
<span id="installing-packages-for-gpus-and-cpus"></span><h2>Installing CUDA-enabled packages like TensorFlow and PyTorch<a class="headerlink" href="#installing-cuda-enabled-packages-like-tensorflow-and-pytorch" title="Permalink to this heading">¶</a></h2>
<p>In conda-forge, some packages are available with GPU support. These packages not only take significantly longer to compile and build, but they also result in rather large binaries that users then download. As an effort to maximize accessibility for users with lower connection and/or storage bandwidth, there is an ongoing effort to limit installing packages compiled for GPUs unnecessarily on CPU-only machines by default. This is accomplished by adding a run dependency, <code class="docutils literal notranslate"><span class="pre">__cuda</span></code>, that detects if the local machine has a GPU. However, this introduces challenges to users who may prefer to still download and use GPU-enabled packages even on a non-GPU machine. For example, login nodes on HPCs often do not have GPUs and their compute counterparts with GPUs often do not have internet access. In this case, a user can override the default setting via the environment variable <code class="docutils literal notranslate"><span class="pre">CONDA_OVERRIDE_CUDA</span></code> to install GPU packages on the login node to be used later on the compute node. At the time of writing (February 2022), we have concluded this safe default behavior is best for most of conda-forge users, with an easy override option available and documented. Please let us know if you have thoughts on or issues with this.</p>
<p>In order to override the default behavior, a user can set the environment variable <code class="docutils literal notranslate"><span class="pre">CONDA_OVERRIDE_CUDA</span></code> like below to install TensorFlow with GPU support even on a machine with CPU only.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nv">CONDA_OVERRIDE_CUDA</span><span class="o">=</span><span class="s2">&quot;11.2&quot;</span> conda install <span class="s2">&quot;tensorflow==2.7.0=cuda112*&quot;</span> -c conda-forge
<span class="c1"># OR</span>
<span class="nv">CONDA_OVERRIDE_CUDA</span><span class="o">=</span><span class="s2">&quot;11.2&quot;</span> mamba install <span class="s2">&quot;tensorflow==2.7.0=cuda112*&quot;</span> -c conda-forge
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You should select the cudatoolkit version most appropriate for your GPU; currently, we have “10.2”, “11.0”, “11.1”, and “11.2” builds available, where the “11.2” builds are compatible with all cudatoolkits&gt;=11.2. At the time of writing (Mar 2022), there seems to be a bug in how the CUDA builds are resolved by <code class="docutils literal notranslate"><span class="pre">mamba</span></code>, defaulting to <code class="docutils literal notranslate"><span class="pre">cudatoolkit==10.2</span></code>; thus, it is prudent to be as explicit as possible like above or by adding <code class="docutils literal notranslate"><span class="pre">cudatoolkit&gt;=11.2</span></code> or similar to the line above.</p>
</div>
<p>For context, installing the TensorFlow 2.7.0 CUDA-enabled variant, <code class="docutils literal notranslate"><span class="pre">tensorflow==2.7.0=cuda*</span></code>, results in approximately 2 GB of packages to download while the CPU variant, <code class="docutils literal notranslate"><span class="pre">tensorflow=2.7.0=cpu*</span></code>, results in approximately 200 MB to download. That is a significant bandwidth and storage wasted if one only needs the CPU only variant!</p>
</section>
<section id="using-pypy-as-an-interpreter">
<span id="pypy"></span><h2>Using PyPy as an interpreter<a class="headerlink" href="#using-pypy-as-an-interpreter" title="Permalink to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">conda-forge</span></code> channel supports creating and installing packages into
environments using the <a class="reference external" href="https://www.pypy.org">PyPy interpreter</a>. Many packages are already
available. You need to enable the <code class="docutils literal notranslate"><span class="pre">conda-forge</span></code> channel and use
the <code class="docutils literal notranslate"><span class="pre">pypy</span></code> identifier when creating your environment:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ conda create -c conda-forge -n my-pypy-env pypy <span class="nv">python</span><span class="o">=</span><span class="m">3</span>.8
$ conda activate my-pypy-env
</pre></div>
</div>
<p>Currently supported python versions are 3.8 and 3.9. Support for <code class="docutils literal notranslate"><span class="pre">pypy3.7</span></code>
has been dropped. While you can still create a python 3.7 environment, you
you will not be getting updates as new package versions are released (including
pypy itself).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As of March 8 2020, if you are using defaults as a low priority channel,
then you need to use strict channel priority as the metadata in defaults
has not been patched yet which allows cpython extension packages to be
installed alongside pypy.</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ conda config --set channel_priority strict
</pre></div>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
        <p class="logo"><a href="../../../../index.html" title="../../../index">
          <img class="logo" src="../_static/logo_black_on_trans.png" alt="Logo"/>
        </a></p><div class="sphinx-toc sphinxlocaltoc">
    <h3><a href="../index.html">Overview</a></h3>
    <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="00_intro.html">User Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="introduction.html">A brief introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="announcements.html">Announcements</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Tips &amp; tricks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#using-multiple-channels">Using multiple channels</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#why-does-that-happen">Why does that happen?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#how-to-fix-it">How to fix it?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#using-external-message-passing-interface-mpi-libraries">Using External Message Passing Interface (MPI) Libraries</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installing-apple-intel-packages-on-apple-silicon">Installing Apple Intel packages on Apple Silicon</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installing-cuda-enabled-packages-like-tensorflow-and-pytorch">Installing CUDA-enabled packages like TensorFlow and PyTorch</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-pypy-as-an-interpreter">Using PyPy as an interpreter</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="ci-skeleton.html">Using conda-smithy to manage your CI</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html">FAQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html">Becoming involved</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_to_get_help.html">How to get help at conda-forge</a></li>
<li class="toctree-l2"><a class="reference internal" href="talks.html">Talks and resources about conda-forge</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../maintainer/00_intro.html">Maintainer Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../orga/00_intro.html">Organisation Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/00_intro.html">Miscellaneous</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contracting/00_intro.html">Contracting Information</a></li>
</ul>

  </div>
  <div class="sphinxprev">
    <h4>Previous page</h4>
    <p class="topless"><a href="announcements.html"
                          title="Previous page">&larr; Announcements</a></p>
  </div>
  <div class="sphinxnext">
    <h4>Next page</h4>
    <p class="topless"><a href="ci-skeleton.html"
                          title="Next page">&rarr; Using conda-smithy to manage your CI</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/user/tipsandtricks.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
    
    
        <div class="sidebar-toggle-group no-js">
            
            <button class="sidebar-toggle" id="sidebar-hide" title="Hide the sidebar menu">
                 «
                <span class="show-for-small">hide menu</span>
                
            </button>
            <button class="sidebar-toggle" id="sidebar-show" title="Show the sidebar menu">
                
                <span class="show-for-small">menu</span>
                <span class="hide-for-small">sidebar</span>
                 »
            </button>
        </div>
    
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ci-skeleton.html" title="Using conda-smithy to manage your CI"
             >next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="announcements.html" title="Announcements"
             >previous</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">conda-forge 2022.08.03 documentation</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="00_intro.html" >User Documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Tips &amp; tricks</a></li> 
      </ul>
    </div>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2016-2022, conda-forge.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.1.1.
    </div>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>